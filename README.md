# Домашнее задание к занятию "`Репликация и масштабирование. Часть 2`" - `Корбут Евгений`

## Задание 1
`Опишите основные преимущества использования масштабирования методами:`
* активный master-сервер и пассивный репликационный slave-сервер;
* master-сервер и несколько slave-серверов.

## Ответ.

### Активный master-сервер и пассивный репликационный slave-сервер.

`Преимущества:`
`Отказоустойчивость: при сбое на master возможно быстрое переключение на slave.`
`Резервное копирование: slave можно использовать для безопасного бэкапа без нагрузки на master.`
`Простота архитектуры: легко реализуется и администрируется.`
`Защита данных: репликация снижает риск потери данных при аппаратных или программных сбоях.`

### Master-сервер и несколько slave-серверов.

`Преимущества:`
`Отказоустойчивость: при отказе одного slave система продолжает работать, а также есть возможность выбрать новый master среди slave.`
`Горизонтальное масштабирование чтения: распределение read-запросов между slave-серверами сильно увеличивает пропускную способность системы.`
`Гибкость архитектуры: можно добавлять slave-серверы по мере роста нагрузки.`

---

## Задание 2

`Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц:`
* пользователи,
* книги,
* магазины (столбцы произвольно).
`Опишите принципы построения системы и их разграничение или разбивку между базами данных.`
`Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.`

## Ответ.

### Предположим возможные исходные данные - таблицы.

`Пользователи: users (id, name, email, region)`
`Книги: books (id, title, author, category)`
`Магазины: stores (id, city, region, address)`

### Вертикальный шардинг (разбивка по функционалу).

| База данных   | Таблицы | Причина                |
| ------------- | ------- | ---------------------- |
| **UserDB**    | users   | Высокая write-нагрузка |
| **CatalogDB** | books   | Read-heavy             |
| **StoreDB**   | stores  | Справочные данные      |

### Горизонтальный шардинг (внутри БД).

#### Горизонтальный шардинг users (ключ шардинга: user_id).

`UserDB_shard_1 : id 1–1M`
`UserDB_shard_2 : id 1M–2M`
`UserDB_shard_3 : id 2M–3M`

#### Горизонтальный шардинг books (ключ шардинга: category).

`Books_shard_1 : fiction`
`Books_shard_2 : science`
`Books_shard_3 : education`

#### Горизонтальный шардинг stores (ключ шардинга: city).

`Stores_shard_1 : Moscow`
`Stores_shard_2 : Saint Petersburg`
`Stores_shard_3 : Chelyabinsk`

### Режимы работы серверов.

#### UserDB.

* Master — записи (INSERT / UPDATE);
* Slave — чтение;
* Репликация.

#### CatalogDB.

* Master — редкие изменения;
* Несколько Slave — чтение.

#### StoreDB.

* Master — очень редкие изменения;
* Slave — чтение.

### Блоксхема архитектуры.

                    ┌─────────────────┐
                    │   Application   │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │   DB Router /   │
                    │     Proxy       │
                    └────────┬────────┘
          ┌──────────────────┼──────────────────┐
          │                  │                  │
 ┌────────▼────────┐ ┌───────▼─────────┐ ┌───────▼─────────┐
 │     UserDB      │ │    CatalogDB    │ │     StoreDB     │
 │ (vertical shard)│ │ (vertical shard)│ │ (vertical shard)│
 └────────┬────────┘ └────────┬────────┘ └────────┬────────┘
          │                   │                   │
 ┌────────▼────────┐  ┌───────▼────────┐   ┌──────▼───────┐
 │ User shard 1    │  │ Book shard 1   │   │ Store master │
 │ Master + Slave  │  │ Master + Slave │   │ + Slaves     │
 ├─────────────────┤  ├────────────────┤   └──────────────┘
 │ User shard 2    │  │ Book shard 2   │
 │ Master + Slave  │  │ Master + Slave │
 ├─────────────────┤  ├────────────────┤
 │ User shard 3    │  │ Book shard 3   │
 │ Master + Slave  │  │ Master + Slave │
 └─────────────────┘  └────────────────┘
---

### Задание 3*
`Выполните конфигурацию master-master репликации. Произведите проверку.`

## Ответ.

---
